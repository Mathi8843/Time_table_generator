<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timetable Config Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .dynamic-section { margin-bottom: 2rem; border: 1px solid #ddd; padding: 1rem; }
        .form-section { margin-bottom: 1.5rem; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Timetable Configuration Generator</h1>
        
        <div id="configForm">
            <!-- Basic Config -->
            <div class="dynamic-section">
                <h4>Basic Setup</h4>
                <div class="form-section">
                    <label class="form-label">Class Names (space-separated):</label>
                    <input type="text" class="form-control" id="classNames" required>
                </div>

                <div class="form-section">
                    <label class="form-label">Total Periods Per Day:</label>
                    <input type="number" class="form-control" id="periodsPerDay" min="1" required>
                </div>
            </div>

            <!-- Period Setup -->
            <div class="dynamic-section">
                <h4>Period Configuration</h4>
                <div class="form-section">
                    <label class="form-label">Break Periods (comma-separated period numbers):</label>
                    <input type="text" class="form-control" id="breakPeriods">
                </div>

                <div class="form-section">
                    <label class="form-label">Lunch Period Number:</label>
                    <input type="number" class="form-control" id="lunchPeriod" min="1">
                </div>
            </div>

            <!-- Class Subjects -->
            <div class="dynamic-section" id="classSubjectsSection">
                <h4>Class Subjects</h4>
                <div id="classSubjects"></div>
                <button class="btn btn-secondary" onclick="addClassSubject()">Add Class</button>
            </div>

            <!-- Staff Configuration -->
            <div class="dynamic-section">
                <h4>Staff Members</h4>
                <div id="staffMembers"></div>
                <button class="btn btn-secondary" onclick="addStaffMember()">Add Staff</button>
            </div>

            <!-- Special Hours -->
            <div class="dynamic-section">
                <h4>Special Hours</h4>
                <div id="specialHours"></div>
                <button class="btn btn-secondary" onclick="addSpecialHour()">Add Special Hour</button>
            </div>

            <button class="btn btn-primary" onclick="generateConfig()">Generate Config File</button>
        </div>
    </div>

    <script>
        function addClassSubject() {
            const container = document.getElementById('classSubjects');
            const classCount = container.children.length + 1;
            
            const div = document.createElement('div');
            div.className = 'form-section';
            div.innerHTML = `
                <h5>Class ${classCount}</h5>
                <input type="text" class="form-control mb-2" placeholder="Class name">
                <div class="subject-fields"></div>
                <button class="btn btn-sm btn-outline-secondary" 
                        onclick="addSubjectFields(this)">Add Subject</button>
            `;
            container.appendChild(div);
        }

        function addSubjectFields(button) {
            const container = button.previousElementSibling;
            const subjectCount = container.children.length + 1;
            
            const div = document.createElement('div');
            div.className = 'subject-field';
            div.innerHTML = `
                <input type="text" placeholder="Subject name" class="form-control mb-1">
                <input type="number" placeholder="Total hours" class="form-control mb-1">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="hasLab">
                    <label class="form-check-label" for="hasLab">Has Lab</label>
                </div>
            `;
            container.appendChild(div);
        }

        function addStaffMember() {
            const container = document.getElementById('staffMembers');
            const staffCount = container.children.length + 1;
            
            const div = document.createElement('div');
            div.className = 'form-section';
            div.innerHTML = `
                <h5>Staff Member ${staffCount}</h5>
                <input type="text" class="form-control mb-2" placeholder="Staff name">
                <input type="text" class="form-control mb-2" placeholder="Subjects taught (comma-separated)">
                <input type="number" class="form-control" placeholder="Max hours per day" min="1">
            `;
            container.appendChild(div);
        }

        function addSpecialHour() {
            const container = document.getElementById('specialHours');
            const specialCount = container.children.length + 1;
            
            const div = document.createElement('div');
            div.className = 'form-section';
            div.innerHTML = `
                <input type="text" class="form-control mb-1" placeholder="Special hour name">
                <input type="number" class="form-control" placeholder="Hours required" min="1">
            `;
            container.appendChild(div);
        }

        function generateConfig() {
            const config = {
                classes: document.getElementById('classNames').value.split(' '),
                days: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
                periods_per_day: parseInt(document.getElementById('periodsPerDay').value),
                break_periods: document.getElementById('breakPeriods').value.split(',').map(Number),
                lunch_period: parseInt(document.getElementById('lunchPeriod').value) - 1,
                subjects: {},
                staff: [],
                special_hours: {}
            };

            // Process class subjects
            document.querySelectorAll('#classSubjects > div').forEach(classDiv => {
                const className = classDiv.querySelector('input').value;
                const subjects = [];
                
                classDiv.querySelectorAll('.subject-field').forEach(subjectDiv => {
                    const inputs = subjectDiv.querySelectorAll('input');
                    subjects.push({
                        name: inputs[0].value,
                        total_hours: parseInt(inputs[1].value),
                        has_lab: inputs[2].checked
                    });
                });
                
                config.subjects[className] = subjects;
            });

            // Process staff members
            document.querySelectorAll('#staffMembers > div').forEach(staffDiv => {
                const inputs = staffDiv.querySelectorAll('input');
                config.staff.push({
                    name: inputs[0].value,
                    subjects_taught: inputs[1].value.split(','),
                    max_hours_per_day: parseInt(inputs[2].value)
                });
            });

            // Process special hours
            document.querySelectorAll('#specialHours > div').forEach(specialDiv => {
                const inputs = specialDiv.querySelectorAll('input');
                config.special_hours[inputs[0].value] = parseInt(inputs[1].value);
            });

            // Create downloadable JSON
            const dataStr = JSON.stringify(config, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', 'timetable_config.json');
            link.click();
        }
    </script>
</body>
</html>